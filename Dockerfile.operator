# PumpGuard Kubernetes Operator Image
FROM node:20-alpine

WORKDIR /app

# Copy operator package
COPY operator/package*.json ./
RUN npm ci --only=production

# Copy operator source and shared utils
COPY operator/src/ ./src/
COPY src/utils/logger.js ./src/utils/

# Create non-root user
RUN addgroup -g 1001 -S operator && \
    adduser -S operator -u 1001 -G operator && \
    chown -R operator:operator /app

USER operator

CMD ["node", "src/index.js"]

